# OemPOS

Sistema de Punto de Venta (POS) multiplataforma desarrollado en Node.js, Express, Sequelize y SQL Server como backend, con Ionic Angular como frontend.

---

## üõçÔ∏è Estado Actual del Proyecto

### Semana 1-2: Setup del Proyecto ‚úÖ COMPLETADO
- Base de datos SQL Server conectada mediante Sequelize
- Modelos implementados: Product, Category, Subcategory, ProductImage, User, Role, Permission
- Sistema de relaciones entre entidades configurado
- CRUD de productos completo y funcional

### Semana 3-4: Autenticaci√≥n y Seguridad ‚úÖ COMPLETADO
- Login y registro de usuarios implementado
- Autenticaci√≥n JWT funcionando correctamente
- Middleware `verifyToken` activo en todas las rutas
- Sistema de roles y permisos implementado
- Middlewares `requirePermission` y `requireRole` operativos

### Semana 5-6: Ventas y Cupones ‚úÖ COMPLETADO
- CRUD de Orders, OrderItems, OrderQueue completo
- Sistema de c√≥digos autom√°ticos (O001, P001, D001, S001) implementado
- Gesti√≥n de cupones y descuentos funcionando
- Implementada l√≥gica para aplicar cupones seg√∫n m√©todo de pago
- Cola de atenci√≥n con priorizaci√≥n implementada
- Sistema de caja implementado con apertura/cierre
- Comprobantes de venta generados autom√°ticamente
- Control de inventario integrado con ventas

### Semana 7-8: Reportes y Caja ‚úÖ COMPLETADO
- Sistema de caja con apertura, cierre y arqueos
- Reportes de caja con totales por m√©todo de pago
- Reportes de inventario implementados
- Reportes de ventas y comprobantes
- Toma de inventario implementada
- Dashboard con estad√≠sticas generales

### Semana 9-10: Optimizaciones y Rendimiento ‚úÖ COMPLETADO
- Sistema de cach√© implementado para consultas frecuentes
- Transacciones robustas con reintentos autom√°ticos
- Optimizaci√≥n de consultas SQL
- Mejoras en el manejo de errores
- Logging estructurado y formateado
- Middlewares de seguridad y compresi√≥n
- Validaci√≥n de datos y herramientas de diagn√≥stico

### Semana 11-12: Frontend Ionic - Estructura Base ‚úÖ COMPLETADO (40%)
- Configuraci√≥n inicial del proyecto Ionic Angular
- Estructura modular por caracter√≠sticas implementada
- Sistema de autenticaci√≥n con JWT implementado
- Interceptor HTTP para manejo de tokens
- Guardias de ruta para protecci√≥n de p√°ginas
- M√≥dulos lazy-loading configurados
- Componente de login funcional
- Dashboard administrativo b√°sico
- Integraci√≥n con backend para autenticaci√≥n

### Semana 13-14: Frontend Ionic - M√≥dulos Funcionales ‚è≥ EN PROGRESO (10%)
- Navegaci√≥n principal y men√∫ lateral
- M√≥dulo de Productos
- M√≥dulo de Pedidos
- M√≥dulo de Caja y Pagos
- M√≥dulo de Inventario
- M√≥dulo de Reportes
- Integraci√≥n con backend para datos

---

## üîç Pr√≥ximas Etapas

### Semana 15-16: Integraci√≥n y UX
- Completar UI/UX de todas las pantallas
- Formularios avanzados con validaci√≥n
- Integraci√≥n con c√°mara para escaneo de c√≥digos
- Gesti√≥n de usuarios y permisos desde frontend
- Pruebas de integraci√≥n entre frontend y backend

### Semana 17-18: Funcionalidad Offline y Despliegue
- Sincronizaci√≥n offline con IndexedDB
- Gesti√≥n de conflictos en datos
- Configuraci√≥n de entorno de producci√≥n
- Empaquetado para plataformas m√≥viles (Android/iOS)
- Empaquetado para escritorio con Electron
- Documentaci√≥n de usuario final

---

## üîÅ Modelo de Negocio y Flujo de Trabajo

### üß© Modelo de Negocio
- **Tipo**: Venta minorista presencial
- **Canal**: Punto de orden (vendedor) + Punto de caja (cajero)
- **Clientes**: ORDEN (inmediato) / PEDIDO (programado) / DELIVERY (a domicilio) / SALON (consumo en local)
- **Medios de Pago**: Efectivo, Tarjeta, Transferencia
- **Valor Agregado**: Descuentos especiales en efectivo, pedidos programables
- **Sistema**: Transacciones, cupones, comprobantes, estad√≠sticas

---

### üîÑ Flujo de Trabajo Implementado

#### üë§ VENDEDOR (Punto de Orden)
1. Recibe al cliente
2. Registra tipo de transacci√≥n: ORDEN, PEDIDO, DELIVERY o SALON
3. Recopila datos seg√∫n tipo de operaci√≥n
4. Agrega productos al pedido
5. Sistema genera c√≥digo √∫nico autom√°tico (Ej: O001, P001)
6. Registra medio de pago tentativo
7. Env√≠a transacci√≥n a la cola de atenci√≥n

#### üíµ CAJERO (Punto de Caja)
1. Abre caja al iniciar turno
2. Gestiona cola de atenci√≥n con priorizaci√≥n
3. Llama al siguiente cliente seg√∫n prioridad
4. Confirma o modifica m√©todo de pago
5. Procesa cobro y aplica cupones si corresponde
6. Registra pagos completos o se√±as para pedidos
7. Genera comprobante de venta
8. Actualiza inventario autom√°ticamente
9. Cierra caja al finalizar turno

---

## üîê Sistema de Roles y Permisos

### Roles Principales
- **VENDEDOR**: carga pedidos
- **CAJERO**: procesa pagos
- **SUPERVISOR**: audita operaciones
- **ADMINISTRADOR**: gesti√≥n completa del sistema

### Permisos Implementados

#### üì¶ Transacciones
- ver_productos
- crear_producto
- modificar_producto
- eliminar_producto
- ver_ordenes
- crear_orden
- modificar_orden
- eliminar_orden
- gestionar_cola
- ver_inventario
- gestionar_inventario

#### üßæ Pagos y Cupones
- procesar_pagos
- ver_cupones
- aplicar_cupones
- gestionar_imagenes
- ver_comprobantes
- anular_comprobantes

#### üìä Reportes y Caja
- ver_reportes
- ver_caja
- abrir_caja
- cerrar_caja
- ver_historial_caja

#### ‚öôÔ∏è Administraci√≥n
- ver_usuarios
- gestionar_usuarios
- configurar_parametros

---

## üß± Arquitectura del Sistema

- **Backend:** Node.js + Express
- **ORM:** Sequelize
- **Base de Datos:** SQL Server 2022
- **Autenticaci√≥n:** JWT con sistema de roles y permisos
- **Frontend:** Ionic Framework (Angular)

### üîó Estructura de Relaciones
- User ‚Üí Role ‚Üí Permissions (relaci√≥n muchos a muchos)
- Product ‚Üí Category / Subcategory / ProductImage / User
- Order ‚Üí OrderItems ‚Üí Products
- Order ‚Üí OrderQueue para gesti√≥n de cola
- Order ‚Üí Receipt para comprobantes
- CashRegister ‚Üí CashTransaction para movimientos de caja
- Product ‚Üí InventoryMovement para control de stock

---

## üìä Modelos implementados

- **Products**: Productos con categor√≠as, subcategor√≠as e im√°genes
- **Orders**: Pedidos con m√∫ltiples tipos (orden, pedido, delivery, salon)
- **OrderItems**: L√≠neas de productos en cada pedido
- **OrderQueue**: Sistema de cola para atenci√≥n de clientes
- **Coupons**: Sistema de cupones con m√∫ltiples reglas
- **Users**: Usuarios con roles y permisos
- **Roles/Permissions**: Sistema modular de permisos
- **CashRegister**: Control de cajas con apertura y cierre
- **CashTransaction**: Movimientos de dinero en caja
- **Receipt**: Comprobantes de venta
- **InventoryMovement**: Control de stock y movimientos

---

## üöÄ Mejoras implementadas

### üìà Sistema de Rendimiento
- **Sistema de cach√©**: Implementaci√≥n de cach√© en memoria para consultas frecuentes con invalidaci√≥n inteligente por patrones
- **Transacciones robustas**: Manejo de transacciones con reintentos autom√°ticos para operaciones cr√≠ticas
- **Optimizaci√≥n de consultas**: Uso de consultas SQL nativas para operaciones de alto rendimiento
- **Control de concurrencia**: Manejo de bloqueos y detecci√≥n de conflictos

### üõ°Ô∏è Seguridad y Estabilidad
- **Headers de seguridad**: Protecci√≥n contra XSS, clickjacking y MIME sniffing
- **Rate limiting**: Limitaci√≥n de solicitudes para prevenir abusos
- **Compresi√≥n de respuestas**: Reducci√≥n del tama√±o de las respuestas para mayor velocidad
- **Graceful shutdown**: Cierre controlado del servidor con manejo correcto de conexiones
- **Manejo de errores centralizado**: Middleware para captura y formateo de errores

### üìä Dashboard y Reportes
- **Dashboard completo**: Panel de control con m√©tricas clave del negocio
- **Reportes por categor√≠a**: An√°lisis de ventas por categor√≠a de productos
- **Tendencias diarias**: Gr√°ficos de ventas diarias con an√°lisis de tendencias
- **Top productos**: Listado de productos m√°s vendidos con estad√≠sticas
- **An√°lisis de pagos**: Distribuci√≥n de ventas por m√©todo de pago
- **M√©tricas de inventario**: Control de stock con alertas de productos con bajo stock

### üß™ Herramientas de Diagn√≥stico
- **Logging estructurado**: Sistema de logs en formato JSON con niveles y timestamping local
- **Validaci√≥n de datos**: Scripts para verificar integridad de datos en la base
- **Herramientas de testing**: Configuraci√≥n de pruebas automatizadas

### üîÑ Frontend - Componentes Implementados
- **Sistema de autenticaci√≥n**: Login con JWT y almacenamiento seguro de token
- **Interceptor HTTP**: Inyecci√≥n autom√°tica de token en solicitudes
- **Guardias de ruta**: Protecci√≥n de rutas seg√∫n autenticaci√≥n
- **Estructura modular**: M√≥dulos lazy-loading para optimizaci√≥n de carga
- **Servicios centralizados**: Gesti√≥n de estado y comunicaci√≥n con API

---

## üì± Frontend - Estructura Modular

El frontend se ha organizado en m√≥dulos funcionales para facilitar el mantenimiento:

- **Core**: Servicios centrales, interceptores, modelos y guardias
- **Shared**: Componentes reutilizables y directivas
- **Auth**: M√≥dulo de autenticaci√≥n y autorizaci√≥n
- **Admin**: Dashboard y configuraci√≥n administrativa
- **Productos**: Gesti√≥n de productos y categor√≠as
- **Pedidos**: Creaci√≥n y gesti√≥n de pedidos
- **Caja**: Operaciones de caja y pagos
- **Inventario**: Control de stock y movimientos
- **Reportes**: Estad√≠sticas y reportes generales

---

## üìö Tecnolog√≠as Utilizadas

### Backend
- Node.js v18+
- Express.js v5.1.0
- Sequelize ORM v6.37.7
- SQL Server 2022
- JWT para autenticaci√≥n
- bcrypt para cifrado de contrase√±as
- Multer para gesti√≥n de im√°genes
- Helmet para seguridad de cabeceras HTTP
- Node-Cache para sistema de cach√© en memoria
- Winston para logging avanzado
- Jest + Supertest para pruebas automatizadas

### Frontend
- Ionic Framework v8.0
- Angular v19.0
- RxJS para programaci√≥n reactiva
- IonicStorage para almacenamiento local
- JWT-decode para manejo de tokens
- Ionic Native para acceso a funciones nativas

---

## üîç Pr√≥ximas Implementaciones

| Prioridad | Tarea |
|-----------|-------|
| üî• | Completar interfaces de usuario para todos los m√≥dulos |
| üî• | Implementar gesti√≥n de pedidos y cola de atenci√≥n |
| üî• | Implementar integraci√≥n con impresoras t√©rmicas |
| üî• | Sistema de env√≠o de comprobantes por email |
| üõ†Ô∏è | Implementar tests automatizados |
| üõ†Ô∏è | Sistema de backups y restauraci√≥n |
| üõ†Ô∏è | Integraci√≥n con m√©todos de pago electr√≥nicos |
| üõ†Ô∏è | Funcionalidad offline con sincronizaci√≥n |

---

## üìÇ Estructura del Proyecto

```
oempos/
‚îú‚îÄ‚îÄ backend/         # API REST en Node.js + Express
‚îÇ   ‚îú‚îÄ‚îÄ config/      # Configuraci√≥n de BD y entorno
‚îÇ   ‚îú‚îÄ‚îÄ controllers/ # L√≥gica de negocio
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/ # Middlewares de autenticaci√≥n, etc.
‚îÇ   ‚îú‚îÄ‚îÄ models/      # Modelos Sequelize
‚îÇ   ‚îú‚îÄ‚îÄ routes/      # Definici√≥n de rutas API
‚îÇ   ‚îú‚îÄ‚îÄ utils/       # Utilidades (cach√©, logging, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ scripts/     # Scripts de mantenimiento
‚îÇ   ‚îî‚îÄ‚îÄ logs/        # Directorio de logs
‚îÇ
‚îú‚îÄ‚îÄ frontend/        # Aplicaci√≥n Ionic Angular
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/      # M√≥dulo de administraci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/       # Autenticaci√≥n y login
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ caja/       # M√≥dulo de caja
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/       # Servicios centralizados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventario/ # Gesti√≥n de inventario
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pedidos/    # Gesti√≥n de pedidos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productos/  # Gesti√≥n de productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reportes/   # Informes y estad√≠sticas
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/     # Componentes compartidos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/         # Recursos est√°ticos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ environments/   # Configuraci√≥n por entorno
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ theme/          # Estilo global
‚îÇ   ‚îú‚îÄ‚îÄ capacitor.config.ts # Configuraci√≥n para m√≥viles
‚îÇ   ‚îî‚îÄ‚îÄ ionic.config.json   # Configuraci√≥n de Ionic
‚îÇ
‚îî‚îÄ‚îÄ docs/            # Documentaci√≥n del proyecto
```

---

## üîê Variables de entorno (.env)

```
DB_HOST=localhost
DB_USER=sa
DB_PASSWORD=tu_password
DB_NAME=gustados
DB_INSTANCE=SQLEXPRESS
DB_DIALECT=mssql
JWT_SECRET=tu_secreto
PORT=3001
NODE_ENV=development
```

---

## üöÄ Instalaci√≥n y Ejecuci√≥n

### Backend
```bash
# Clonar el repositorio
git clone https://github.com/tu-usuario/oempos.git

# Instalar dependencias del backend
cd oempos/backend
npm install

# Configurar variables de entorno
cp .env.example .env
# Editar .env con tus credenciales

# Iniciar en modo desarrollo
npm run dev

# O iniciar en modo producci√≥n
npm start
```

### Frontend
```bash
# Instalar dependencias del frontend
cd oempos/frontend
npm install

# Iniciar servidor de desarrollo
ionic serve

# Compilar para producci√≥n
ionic build --prod

# Generar aplicaci√≥n para Android
ionic capacitor add android
ionic capacitor build android
```

> El backend corre en `http://localhost:3001` por defecto.
> El frontend corre en `http://localhost:8100` por defecto.

---

### üí° Documentaci√≥n de API disponible en la [Wiki](https://github.com/carlostcba/oempos/wiki) del proyecto.

---

## üìä Capturas de Pantalla

(Pr√≥ximamente)

---

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor, sigue estos pasos:

1. Haz un fork del repositorio
2. Crea una rama con tu caracter√≠stica (`git checkout -b feature/amazing-feature`)
3. Realiza tus cambios y commits (`git commit -m 'Add amazing feature'`)
4. Sube tu rama (`git push origin feature/amazing-feature`)
5. Abre un Pull Request

---

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.